# Backend КИБЕР РЫВОК

## Описание

Backend часть приложения КИБЕР РЫВОК, реализующая API для управления симуляцией агентов и их взаимодействия.

## Новая функциональность аутентификации

### Модели

#### Пользователь (User)

- `id` - уникальный идентификатор пользователя
- `username` - имя пользователя (уникальное)
- `email` - email пользователя (уникальное)
- `hashed_password` - хэшированный пароль пользователя
- `registered_time` - время регистрации
- `last_activity` - время последней активности
- `agents` - список агентов пользователя

#### Агент (Agent)

- Обновлена модель агента с добавлением связи с пользователем (`user_id`)

### Endpoints аутентификации

#### POST /api/auth/register

Регистрация нового пользователя

**Request:**

```json
{
  "username": "string",
  "email": "string",
  "password": "string"
}
```

**Response:**

```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "registered_time": "2026-02-17T10:00:00"
}
```

#### POST /api/auth/login

Аутентификация пользователя и получение JWT токена

**Request:**

```json
{
  "username": "string",
  "password": "string"
}
```

**Response:**

```json
{
  "access_token": "string",
  "token_type": "bearer"
}
```

#### GET /api/users/me

Получение информации о текущем пользователе

**Headers:**

```
Authorization: Bearer <token>
```

**Response:**

```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "registered_time": "2026-02-17T10:00:00"
}
```

### Защищенные endpoints

После аутентификации все существующие endpoints требуют JWT токен в заголовке Authorization.

#### GET /api/agents

Получение списка агентов текущего пользователя

#### GET /api/agents/{agent_id}

Получение информации об агенте (только если он принадлежит пользователю)

#### POST /api/agents

Создание нового агента, привязанного к текущему пользователю

И другие endpoints, которые теперь фильтруются по принадлежности агентов текущему пользователю.

### Безопасность

- Пароли хэшируются с использованием bcrypt
- JWT токены используются для аутентификации
- Все endpoints, кроме регистрации и логина, защищены middleware'ом аутентификации
- Проверяется принадлежность агентов и других ресурсов текущему пользователю

## Установка и запуск

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Настройте переменные окружения в файле `.env`

3. Запустите сервер:

```bash
uvicorn backend.main:app --reload
```
